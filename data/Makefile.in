# Makefile for data files
# Copyright (C) 2002-2006 Olivier Sessink <olivier@bluefish.openoffice.nl>

PACKAGE = @PACKAGE@
VERSION = @VERSION@

SHELL = /bin/sh

top_srcdir = @top_srcdir@
top_builddir = @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
pkgdatadir = @pkgdatadir@
datadir = @datadir@
localedir = $(datadir)/locale

FDMENU=@FDMENU@
FDMIME=@FDMIME@
UPDATE_DESKTOP=@UPDATE_DESKTOP@
UPDATE_MIME=@UPDATE_MIME@
GMIMEINFO=@GMIMEINFO@
GAPPREG=@GAPPREG@
ICONPATH=@ICONPATH@
THEMEPATH=@THEMEPATH@
INSTALLDATA=@INSTALLDATA@

INSTALL = @INSTALL@
INSTALL_DIR = $(INSTALL) -d -m 755 
INSTALL_DATA = $(INSTALL) -m 644

DEFAULTFILES = \
    highlighting filetypes encodings \
    custom_menu custom_menu.fr custom_menu.de \
    textstyles \
    php.bflang \
    c.bflang \
    css.bflang \
    html.bflang \
    java.bflang \
    xml.bflang \
    po.bflang \
    python.bflang

FUNCREFFILES = \
	bflib_css2.xml.gz \
	bflib_php4.xml.gz \
	bflib_php5.xml.gz \
	bflib_php5_with_examples.xml.gz \
	bflib_python_2.3.xml.gz \
	bflib_xhtml.xml.gz \
	bflib_dom.xml.gz


%.xml.gz : %.xml
	gzip $< -c > $@

all: $(FUNCREFFILES)

install-fdmenu:
	$(INSTALL_DIR) $(DESTDIR)$(FDMENU)
	$(INSTALL_DATA) bluefish.desktop $(DESTDIR)$(FDMENU)/$(PACKAGE).desktop
	$(INSTALL_DATA) bluefish-project.desktop $(DESTDIR)$(FDMENU)/$(PACKAGE)-project.desktop

install-update-menu:
	$(UPDATE_DESKTOP)

install-fdmime:
	$(INSTALL_DIR) $(DESTDIR)$(FDMIME)/packages
	$(INSTALL_DATA) bluefish.xml $(DESTDIR)$(FDMIME)/packages/$(PACKAGE).xml

install-update-mime:
	$(UPDATE_MIME) $(FDMIME)

install-gnome-2.4-mime:
	$(INSTALL_DIR) $(DESTDIR)$(GMIMEINFO)
	$(INSTALL_DATA) bluefish.mime $(DESTDIR)$(GMIMEINFO)/$(PACKAGE).mime
	$(INSTALL_DATA) bluefish.keys $(DESTDIR)$(GMIMEINFO)/$(PACKAGE).keys

install-gnome-2.4-appreg:
	$(INSTALL_DIR) $(DESTDIR)$(GAPPREG)
	$(INSTALL_DATA) bluefish.applications $(DESTDIR)$(GAPPREG)/$(PACKAGE).applications

install-icon:
	$(INSTALL_DIR) $(DESTDIR)$(ICONPATH); \
	$(INSTALL_DATA) gnome-application-bluefish.png $(DESTDIR)$(ICONPATH)/gnome-mime-application-bluefish-project.png; \

# this is for now, later install pictures in .svgz
install-theme-icon:
	$(INSTALL_DIR) $(DESTDIR)$(THEMEPATH)/48x48/mimetypes
	$(INSTALL_DATA) gnome-application-bluefish.png \
		$(DESTDIR)$(THEMEPATH)/48x48/mimetypes/gnome-mime-application-bluefish-project.png

install: all $(INSTALLDATA)
	$(INSTALL_DIR) $(DESTDIR)$(pkgdatadir)
	for file in $(DEFAULTFILES) ; do \
		$(INSTALL_DATA) $$file $(DESTDIR)$(pkgdatadir) ;\
	done
	for file in $(FUNCREFFILES) ; do \
		$(INSTALL_DATA) $$file $(DESTDIR)$(pkgdatadir) ;\
	done

uninstall:
	rm -f $(DESTDIR)$(FDMIME)/packages/$(PACKAGE).xml
	rm -f $(DESTDIR)$(GMIMEINFO)/$(PACKAGE).mime
	rm -f $(DESTDIR)$(GMIMEINFO)/$(PACKAGE).keys
	rm -f $(DESTDIR)$(GAPPREG)/$(PACKAGE).applications
	rm -f $(DESTDIR)$(FDMENU)/$(PACKAGE).desktop
	rm -f $(DESTDIR)$(FDMENU)/$(PACKAGE)-project.desktop
	rm -f $(DESTDIR)$(ICONPATH)/gnome-mime-application-bluefish-project.png
	rm -f $(DESTDIR)$(THEMEPATH)/48x48/mimetypes/gnome-mime-application-bluefish-project.png
	@for file in $(DEFAULTFILES) ; do \
		rm -f $(DESTDIR)$(pkgdatadir)$$file ;\
	done
	@for file in $(FUNCREFFILES) ; do \
		rm -f $(DESTDIR)$(pkgdatadir)$$file ;\
	done

clean:
	rm -f $(FUNCREFFILES)

distclean: clean
	rm -f \
		Makefile \
		bluefish.desktop \
		bluefish-project.desktop \
		bluefish.applications \
		bluefish.keys \
		filetypes \
		*.rej \
		*.orig \
		*~


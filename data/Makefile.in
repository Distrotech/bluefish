# Makefile for data files
# Copyright (C) 2002-2004 Olivier Sessink <olivier@bluefish.openoffice.nl>

PACKAGE = @PACKAGE@
VERSION = @VERSION@

SHELL = /bin/sh

top_srcdir = @top_srcdir@
top_builddir = @top_srcdir@
srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
pkgdatadir = @pkgdatadir@
datadir = @datadir@
localedir = $(datadir)/locale

iconpath=@ICONPATH@
gnome1menupath=@GNOME1MENUPATH@
gnome2prefix=@GNOME2PREFIX@
have_gnome_vfs=@HAVE_GNOME_VFS@
gnome2applications=${gnome2prefix}/applications/
gnome2mime-info=${gnome2prefix}/mime-info/
gnome2appreg=${gnome2prefix}/application-registry/
gnome2icons=${gnome2prefix}/pixmaps/

INSTALL = @INSTALL@
INSTALL_DIR = $(INSTALL) -d -m 755 
INSTALL_DATA = ${INSTALL} -m 644

DEFAULTFILES = highlighting.default filetypes.default encodings.default custom_menu.default
FUNCREFFILES = funcref_html.xml funcref_php.xml funcref_css.xml funcref_python.xml
.SUFFIXES: .in .default

.in.default:
	sed -e 's!PKGDATADIR!$(pkgdatadir)!' < $< > $@

all: $(DEFAULTFILES)
	sed -e 's!ICONDIR!$(iconpath)!' < bluefish.desktop.in > bluefish.desktop
	if [ ${have_gnome_vfs} = "1" ] ; then \
		sed -e 's!EXPECT_URIS!true!' -e 's!SUPPORTED_URI_SCHEMES!file,http,ftp,sftp,smb!' < bluefish.applications.in > bluefish.applications ;\
	else \
		sed -e 's!EXPECT_URIS!false!' -e 's!SUPPORTED_URI_SCHEMES!!' < bluefish.applications.in > bluefish.applications ;\
	fi

install: all
	$(INSTALL_DIR) $(DESTDIR)$(pkgdatadir)
	@for file in $(DEFAULTFILES) ; do \
		$(INSTALL_DATA) $$file $(DESTDIR)$(pkgdatadir)/$$file ;\
	done
	@for file in $(FUNCREFFILES) ; do \
		$(INSTALL_DATA) $$file $(DESTDIR)$(pkgdatadir)/$$file ;\
	done
	if [ -d $(gnome2applications) ] ; then \
		$(INSTALL_DATA) bluefish.desktop $(DESTDIR)$(gnome2applications) ;\
	fi
	if [ -d $(gnome1menupath) ] ; then \
		$(INSTALL_DIR) $(DESTDIR)$(gnome1menupath)/Applications ;\
		$(INSTALL_DATA) bluefish.desktop $(DESTDIR)$(gnome1menupath)/Applications ;\
	fi
	if [ -d $(gnome2appreg) ] ; then \
		$(INSTALL_DATA) bluefish.applications $(DESTDIR)$(gnome2appreg) ;\
	fi
	if [ -d $(gnome2mime-info) ] ; then \
		$(INSTALL_DATA) bluefish.mime $(DESTDIR)$(gnome2mime-info) ;\
		$(INSTALL_DATA) bluefish.keys $(DESTDIR)$(gnome2mime-info) ;\
	fi
	if [ -d $(gnome2icons) ] ; then \
		$(INSTALL_DATA) gnome-application-bluefish.png $(DESTDIR)$(gnome2icons) ;\
	fi

uninstall:
	@for file in $(DEFAULTFILES) ; do \
		rm -f $(DESTDIR)$(pkgdatadir)/$$file ;\
	done
	rm -f $(DESTDIR)$(gnome2menupath)/bluefish.desktop
	rm -f $(DESTDIR)$(gnome1menupath)/Applications/bluefish.desktop
	rm -r $(DESTDIR)$(gnome2appregistry)/bluefish.applications
	rm -f $(DESTDIR)$(gnome2icons)

clean:
	rm -f *.default
	rm -f bluefish.desktop
	rm -f bluefish.applications

distclean: clean
	rm -f Makefile *.rej *.orig
